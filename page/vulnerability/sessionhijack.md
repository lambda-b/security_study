---
title: セッションハイジャック／フィクセーション
next: false
---
# セッションハイジャック／セッションフィクセーション

## 1. 概要・原因

**セッションハイジャック**とは、正当なユーザーのセッションIDを盗み取り、不正にそのユーザーとして振る舞う攻撃です。一方で**セッションフィクセーション**は、攻撃者があらかじめ指定したセッションIDを被害者に使わせ、後から同じIDでアクセスする手法です。

主な原因は以下の通りです：

- セッションIDが推測可能／固定的
- セッションIDをURLに含めて送信
- セッションIDを盗まれても無効化されない設計

## 2. 悪用事例・実際の事件

- 初期のモバイル端末(例：ガラケー)ではCookie未対応が多く、URLにセッションIDを含める設計が広く使われていた。Refererヘッダ等からの漏洩によりセッションIDが盗まれる事例も。

- 公共の無線LAN環境下における**パケット盗聴**によりセッションIDを取得し、ハイジャックされる事例が過去に多発した。

## 3. OWASP ASVS 5.0 における該当要件

| レベル   | 要件番号   | 内容                                               |
|--------|----------|--------------------------------------------------|
| L1〜L3 | V2.1.1   | セッションIDは推測不可能で十分にランダムであること             |
| L1〜L3 | V2.1.2   | セッションIDはHTTPS経由でのみ送信されるべき(Secure属性)   |
| L2〜L3 | V2.2.4   | 認証後、セッションIDを再生成すること(フィクセーション防止)    |

## 4. 一般的な対策

- セッションIDの**ランダム性**を確保(推測困難な値を生成)
- セッションIDの**URL埋め込みを禁止**(Cookieの使用推奨)
- 認証後の**セッションID再生成**(フィクセーション対策)
- Cookieに**Secure属性、HttpOnly属性**を設定
- セッションタイムアウトの設定と、長時間操作のないセッションの強制終了

## 5. フレームワーク別の注意点

### Spring Security

- 認証成功時にセッションIDはデフォルトで再生成され、セッションフィクセーション攻撃に対する対策が施されている
- Spring Securityは内部的に `SessionFixationProtectionStrategy` を使用しており、既存のセッション属性を引き継いだ新しいセッションを生成する
- 明示的に動作を設定したい場合は、`http.sessionManagement().sessionFixation()` を用いて設定可能

### Struts／JSP

- Struts自体にはセッション管理の高度な仕組みは少ないが、JavaEEの`HttpSession`を通じて対策可能
- JSPやFilter層で手動でセッションID再生成を行う必要あり
- `request.getSession().invalidate();` によるセッションの無効化と再生成を明示的に実装可能
- `response.encodeURL()`の使用に注意(セッションIDがURLに埋まる可能性あり)
