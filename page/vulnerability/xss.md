---
title: XSS(クロスサイトスクリプティング)
next: false
---

# XSS(クロスサイトスクリプティング)

## 1. 概要・原因

**クロスサイトスクリプティング(XSS)** は、Web アプリケーションに悪意あるスクリプトを挿入し、他のユーザーのブラウザ上で実行させる脆弱性です。

原因の多くは、以下のような **出力時のサニタイズ不足** にあります：

- ユーザー入力を HTML や JavaScript としてそのままページに表示
- エスケープ処理が不十分、あるいは文脈に合っていない

XSS は主に次の 3 種類に分類されます：

- **反射型**：悪意あるリンクを踏ませ、即時スクリプト実行
- **格納型**：掲示板などにスクリプトが保存され、後に他者が閲覧
- **DOM 型**：JavaScript 上で不正に HTML 生成・挿入

## 2. 悪用事例・実際の事件

- **2005 年：MySpace ワーム(Samy ワーム)**: [参考](https://samy.pl/myspace/)

  - ユーザープロフィールに XSS を仕込み、閲覧者に感染
  - 約 100 万人のプロフィールが感染、MySpace は一時機能停止

## 3. OWASP ASVS 5.0 における該当要件

| レベル   | 要件番号 | 内容                                                                             |
| -------- | -------- | -------------------------------------------------------------------------------- |
| L1 ～ L3 | V7.4.2   | 動的な HTML コンテンツは適切にエスケープ(文脈ごと)されていること               |
| L1 ～ L3 | V7.4.3   | クライアント側のスクリプトは信頼できるコンテンツのみを使用していること           |
| L1 ～ L3 | V7.5.1   | フレームやスクリプトの挿入による UI Redress/XSS が防止されていること(CSP など) |

## 4. 一般的な対策

- **出力時のエスケープ処理(文脈依存)**

  - HTML 内：`<`, `>` → `&lt;`, `&gt;`
  - 属性値内：`"` → `&quot;`
  - JavaScript 内：Unicode エスケープ推奨

- **HTTP ヘッダ設定**

  - `Content-Type: text/html; charset=UTF-8`
  - `Content-Security-Policy` の設定によるスクリプト制限

- **ユーザー入力の検証・制限**

  - 不要なタグやスクリプトを入力できないようにする

- **httpOnly 属性の活用**

  - セッション ID などの Cookie を JavaScript からアクセスできなくする

## 5. フレームワーク別の注意点

### React

- **デフォルトで HTML エスケープが有効**

  - JSX での表示例：`<div>{userInput}</div>` → 自動でサニタイズされる

- **`dangerouslySetInnerHTML` 使用時は注意**

  - サニタイズをバイパスするため、使用する場合は外部ライブラリ(DOMPurify 等)で検査が必要

### Spring(Thymeleaf)

- **`${...}`は自動で HTML エスケープされる**
- エスケープ無効化を行う`th:utext`などの使用には注意
- **Spring Security を導入すれば CSP や XSS 対策ヘッダの適用が可能**

### Struts

- **Struts2 は初期状態で XSS に弱い**

  - `escape="false"` の指定は基本避ける
  - `OGNL`式の評価によるインジェクションリスクにも注意

### JSP

- `<%= userInput %>` はエスケープされない → XSS リスクあり
- `c:out` タグの使用を推奨(JSTL)

  ```jsp
  <c:out value="${userInput}" />
  ```
